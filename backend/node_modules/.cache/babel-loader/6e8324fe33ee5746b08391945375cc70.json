{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\xampp\\\\htdocs\\\\DeuxiemeSituation\\\\backend\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\xampp\\\\htdocs\\\\DeuxiemeSituation\\\\backend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:\\\\xampp\\\\htdocs\\\\DeuxiemeSituation\\\\backend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\xampp\\\\htdocs\\\\DeuxiemeSituation\\\\backend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"C:\\\\xampp\\\\htdocs\\\\DeuxiemeSituation\\\\backend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"C:\\\\xampp\\\\htdocs\\\\DeuxiemeSituation\\\\backend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _inherits from\"C:\\\\xampp\\\\htdocs\\\\DeuxiemeSituation\\\\backend\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React from'react';import DetailsTransaction from\"./DetailsTransaction\";import DaoSalle from\"../modele/DaoSalle\";import DaoReservation from\"../modele/DaoReservation\";import DaoObstacle from\"../modele/DaoObstacle\";import DaoTheme from\"../modele/DaoTheme\";/**\r\n * Composant qui affiche la liste des transaction\r\n */var Transactions=/*#__PURE__*/function(_React$Component){_inherits(Transactions,_React$Component);function Transactions(props){var _this;_classCallCheck(this,Transactions);_this=_possibleConstructorReturn(this,_getPrototypeOf(Transactions).call(this,props));_this.state={/**@type {Transaction}**/transactions:null,/**@type {Client}**/client:props.client,/**@type {number}**/details:-1,/**@type {number}**/lastDetails:-1,/**@type {[Reservation, Salle, Theme, [Obstacle]]}**/reservationDetailee:null};return _this;}/**\r\n     * Définit la transaction qui a été séléctionné\r\n     * @param index {number}\r\n     */_createClass(Transactions,[{key:\"details\",value:function details(index){var transactions=this.props.transactions;if(transactions[index].reservation!==\" \"){if(this.state.details===index){this.setState({lastDetails:this.state.details,details:-1});}else{this.setState({details:index});}}}/**\r\n     * Charge le détail d'une réservation\r\n     * @returns {Promise<(Reservation|Salle|Theme|Obstacle[])[]|null|[Reservation, Salle, Theme, *[]]>}\r\n     */},{key:\"loadReservation\",value:function(){var _loadReservation=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var transaction,reservation,salle,obstacle,theme,resaDetail;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(this.state.lastDetails!==this.state.details)){_context.next=21;break;}document.body.style.cursor='progress';transaction=this.props.transactions[this.state.details];_context.next=5;return new DaoReservation().getReservationByTransaction(transaction);case 5:reservation=_context.sent;_context.next=8;return new DaoSalle().getSalleByReservation(reservation);case 8:salle=_context.sent;_context.next=11;return new DaoObstacle().getObstacleByReservation(reservation);case 11:obstacle=_context.sent;_context.next=14;return new DaoTheme().getThemeBySalle(salle);case 14:theme=_context.sent;resaDetail=[reservation,salle,theme,obstacle];this.setState({reservationDetailee:resaDetail});document.body.style.cursor='default';return _context.abrupt(\"return\",resaDetail);case 21:return _context.abrupt(\"return\",this.state.reservationDetailee);case 22:case\"end\":return _context.stop();}}},_callee,this);}));function loadReservation(){return _loadReservation.apply(this,arguments);}return loadReservation;}()/**\r\n     * Affiche ou non le composant DetailsTransaction\r\n     * @link {DetailsTransaction}\r\n     * @returns {null|*}\r\n     */},{key:\"afficherDetails\",value:function afficherDetails(){if(this.state.details>-1){var reservationDetaille=this.loadReservation();return React.createElement(DetailsTransaction,{reservationDetailee:reservationDetaille});}else{return null;}}},{key:\"updateTransaction\",value:function updateTransaction(){//console.log(\"ici\");\nthis.setState({client:this.props.client,details:-1,lastDetails:-1});}},{key:\"render\",value:function render(){var _this2=this;var transactions=this.props.transactions;if(this.state.client.id!==this.props.client.id){this.updateTransaction();return null;}else{//console.log(this.state);\nvar options={weekday:\"short\",day:\"numeric\",month:\"short\",year:\"numeric\"};if(transactions.length>0){return React.createElement(\"section\",{className:\"transactions\"},React.createElement(\"h2\",{className:\"title\"},\"TRANSACTIONS\"),React.createElement(\"section\",{className:\"tableau\"},React.createElement(\"h3\",{className:\"colonne\"},\"Date\"),React.createElement(\"h3\",{className:\"colonne bordure\"},\"Montant\"),transactions.map(function(t,i){var date=new Intl.DateTimeFormat(\"fr-FR\",options).format(t.date);if(transactions[i].reservation!==\" \"){var selected=_this2.state.details===i;return React.createElement(\"section\",{className:\"ligne depense \"+selected,key:i,onClick:_this2.details.bind(_this2,i)},React.createElement(\"span\",{className:\"date\"},date.toUpperCase()),React.createElement(\"span\",{className:\"montant bordure\"},t.montant));}else{return React.createElement(\"section\",{className:\"ligne ajout\",key:i},React.createElement(\"span\",{className:\"date\"},date.toUpperCase()),React.createElement(\"span\",{className:\"montant bordure\"},t.montant));}})),this.afficherDetails());}else{return null;}}}}]);return Transactions;}(React.Component);export{Transactions as default};","map":{"version":3,"sources":["C:/xampp/htdocs/DeuxiemeSituation/backend/src/components/Transactions.js"],"names":["React","DetailsTransaction","DaoSalle","DaoReservation","DaoObstacle","DaoTheme","Transactions","props","state","transactions","client","details","lastDetails","reservationDetailee","index","reservation","setState","document","body","style","cursor","transaction","getReservationByTransaction","getSalleByReservation","salle","getObstacleByReservation","obstacle","getThemeBySalle","theme","resaDetail","reservationDetaille","loadReservation","id","updateTransaction","options","weekday","day","month","year","length","map","t","i","date","Intl","DateTimeFormat","format","selected","bind","toUpperCase","montant","afficherDetails","Component"],"mappings":"g6BAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,kBAAP,KAA+B,sBAA/B,CACA,MAAOC,CAAAA,QAAP,KAAqB,oBAArB,CACA,MAAOC,CAAAA,cAAP,KAA2B,0BAA3B,CACA,MAAOC,CAAAA,WAAP,KAAwB,uBAAxB,CACA,MAAOC,CAAAA,QAAP,KAAqB,oBAArB,CAEA;;MAGqBC,CAAAA,Y,kFACjB,sBAAYC,KAAZ,CAAmB,8CACf,8EAAMA,KAAN,GACA,MAAKC,KAAL,CAAa,CACT,yBACAC,YAAY,CAAE,IAFL,CAGT,oBACAC,MAAM,CAAEH,KAAK,CAACG,MAJL,CAKT,oBACAC,OAAO,CAAE,CAAC,CAND,CAOT,oBACAC,WAAW,CAAE,CAAC,CARL,CAST,qDACAC,mBAAmB,CAAE,IAVZ,CAAb,CAFe,aAclB,CAED;;;wEAIQC,K,CAAM,CACV,GAAML,CAAAA,YAAY,CAAG,KAAKF,KAAL,CAAWE,YAAhC,CACA,GAAIA,YAAY,CAACK,KAAD,CAAZ,CAAoBC,WAApB,GAAoC,GAAxC,CAA4C,CACxC,GAAI,KAAKP,KAAL,CAAWG,OAAX,GAAuBG,KAA3B,CAAiC,CAC7B,KAAKE,QAAL,CAAc,CACVJ,WAAW,CAAE,KAAKJ,KAAL,CAAWG,OADd,CAEVA,OAAO,CAAE,CAAC,CAFA,CAAd,EAIH,CALD,IAKO,CACH,KAAKK,QAAL,CAAc,CACVL,OAAO,CAAEG,KADC,CAAd,EAGH,CACJ,CACJ,CAED;;;kUAKQ,KAAKN,KAAL,CAAWI,WAAX,GAA2B,KAAKJ,KAAL,CAAWG,O,2BACtCM,QAAQ,CAACC,IAAT,CAAcC,KAAd,CAAoBC,MAApB,CAA6B,UAA7B,CACMC,W,CAAc,KAAKd,KAAL,CAAWE,YAAX,CAAwB,KAAKD,KAAL,CAAWG,OAAnC,C,uBACM,IAAIR,CAAAA,cAAJ,GAAqBmB,2BAArB,CAAiDD,WAAjD,C,QAApBN,W,qCACc,IAAIb,CAAAA,QAAJ,GAAeqB,qBAAf,CAAqCR,WAArC,C,QAAdS,K,sCACiB,IAAIpB,CAAAA,WAAJ,GAAkBqB,wBAAlB,CAA2CV,WAA3C,C,SAAjBW,Q,sCACc,IAAIrB,CAAAA,QAAJ,GAAesB,eAAf,CAA+BH,KAA/B,C,SAAdI,K,eACAC,U,CAAa,CAACd,WAAD,CAAcS,KAAd,CAAqBI,KAArB,CAA4BF,QAA5B,C,CACnB,KAAKV,QAAL,CAAc,CACVH,mBAAmB,CAAEgB,UADX,CAAd,EAGAZ,QAAQ,CAACC,IAAT,CAAcC,KAAd,CAAoBC,MAApB,CAA6B,SAA7B,C,gCACOS,U,0CAEC,KAAKrB,KAAL,CAAWK,mB,qKAI3B;;;;gEAKiB,CACb,GAAI,KAAKL,KAAL,CAAWG,OAAX,CAAqB,CAAC,CAA1B,CAA6B,CACzB,GAAImB,CAAAA,mBAAmB,CAAG,KAAKC,eAAL,EAA1B,CACA,MAAO,qBAAC,kBAAD,EAAoB,mBAAmB,CAAED,mBAAzC,EAAP,CACH,CAHD,IAGO,CACH,MAAO,KAAP,CACH,CACJ,C,6DAEkB,CACf;AACA,KAAKd,QAAL,CAAc,CACVN,MAAM,CAAE,KAAKH,KAAL,CAAWG,MADT,CAEVC,OAAO,CAAG,CAAC,CAFD,CAGVC,WAAW,CAAE,CAAC,CAHJ,CAAd,EAKH,C,uCAEQ,iBACL,GAAMH,CAAAA,YAAY,CAAG,KAAKF,KAAL,CAAWE,YAAhC,CACA,GAAI,KAAKD,KAAL,CAAWE,MAAX,CAAkBsB,EAAlB,GAAyB,KAAKzB,KAAL,CAAWG,MAAX,CAAkBsB,EAA/C,CAAmD,CAC/C,KAAKC,iBAAL,GACA,MAAO,KAAP,CACH,CAHD,IAGO,CACH;AACA,GAAMC,CAAAA,OAAO,CAAG,CAACC,OAAO,CAAE,OAAV,CAAmBC,GAAG,CAAE,SAAxB,CAAmCC,KAAK,CAAE,OAA1C,CAAmDC,IAAI,CAAE,SAAzD,CAAhB,CACA,GAAI7B,YAAY,CAAC8B,MAAb,CAAsB,CAA1B,CAA6B,CACzB,MACI,gCAAS,SAAS,CAAC,cAAnB,EACI,0BAAI,SAAS,CAAC,OAAd,iBADJ,CAEI,+BAAS,SAAS,CAAC,SAAnB,EACI,0BAAI,SAAS,CAAC,SAAd,SADJ,CAEI,0BAAI,SAAS,CAAC,iBAAd,YAFJ,CAGK9B,YAAY,CAAC+B,GAAb,CAAiB,SAACC,CAAD,CAAIC,CAAJ,CAAU,CACxB,GAAMC,CAAAA,IAAI,CAAG,GAAIC,CAAAA,IAAI,CAACC,cAAT,CAAwB,OAAxB,CAAiCX,OAAjC,EAA0CY,MAA1C,CAAiDL,CAAC,CAACE,IAAnD,CAAb,CACA,GAAIlC,YAAY,CAACiC,CAAD,CAAZ,CAAgB3B,WAAhB,GAAgC,GAApC,CAAyC,CACrC,GAAMgC,CAAAA,QAAQ,CAAI,MAAI,CAACvC,KAAL,CAAWG,OAAX,GAAuB+B,CAAzC,CACA,MACI,gCAAS,SAAS,CAAE,iBAAmBK,QAAvC,CAAiD,GAAG,CAAEL,CAAtD,CACS,OAAO,CAAE,MAAI,CAAC/B,OAAL,CAAaqC,IAAb,CAAkB,MAAlB,CAAwBN,CAAxB,CADlB,EAEI,4BAAM,SAAS,CAAC,MAAhB,EAAwBC,IAAI,CAACM,WAAL,EAAxB,CAFJ,CAGI,4BAAM,SAAS,CAAC,iBAAhB,EAAmCR,CAAC,CAACS,OAArC,CAHJ,CADJ,CAOH,CATD,IASO,CACH,MACI,gCAAS,SAAS,CAAE,aAApB,CAAmC,GAAG,CAAER,CAAxC,EACI,4BAAM,SAAS,CAAC,MAAhB,EAAwBC,IAAI,CAACM,WAAL,EAAxB,CADJ,CAEI,4BAAM,SAAS,CAAC,iBAAhB,EAAmCR,CAAC,CAACS,OAArC,CAFJ,CADJ,CAMH,CACJ,CAnBA,CAHL,CAFJ,CA0BK,KAAKC,eAAL,EA1BL,CADJ,CA8BH,CA/BD,IA+BO,CACH,MAAO,KAAP,CACH,CACJ,CACJ,C,0BA9HqCnD,KAAK,CAACoD,S,SAA3B9C,Y","sourcesContent":["import React from 'react';\r\nimport DetailsTransaction from \"./DetailsTransaction\";\r\nimport DaoSalle from \"../modele/DaoSalle\";\r\nimport DaoReservation from \"../modele/DaoReservation\";\r\nimport DaoObstacle from \"../modele/DaoObstacle\";\r\nimport DaoTheme from \"../modele/DaoTheme\";\r\n\r\n/**\r\n * Composant qui affiche la liste des transaction\r\n */\r\nexport default class Transactions extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            /**@type {Transaction}**/\r\n            transactions: null,\r\n            /**@type {Client}**/\r\n            client: props.client,\r\n            /**@type {number}**/\r\n            details: -1,\r\n            /**@type {number}**/\r\n            lastDetails: -1,\r\n            /**@type {[Reservation, Salle, Theme, [Obstacle]]}**/\r\n            reservationDetailee: null\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Définit la transaction qui a été séléctionné\r\n     * @param index {number}\r\n     */\r\n    details(index){\r\n        const transactions = this.props.transactions;\r\n        if (transactions[index].reservation !== \" \"){\r\n            if (this.state.details === index){\r\n                this.setState({\r\n                    lastDetails: this.state.details,\r\n                    details: -1\r\n                })\r\n            } else {\r\n                this.setState({\r\n                    details: index,\r\n                })\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Charge le détail d'une réservation\r\n     * @returns {Promise<(Reservation|Salle|Theme|Obstacle[])[]|null|[Reservation, Salle, Theme, *[]]>}\r\n     */\r\n    async loadReservation(){\r\n        if (this.state.lastDetails !== this.state.details) {\r\n            document.body.style.cursor = 'progress';\r\n            const transaction = this.props.transactions[this.state.details];\r\n            const reservation = await new DaoReservation().getReservationByTransaction(transaction);\r\n            const salle = await new DaoSalle().getSalleByReservation(reservation);\r\n            const obstacle = await new DaoObstacle().getObstacleByReservation(reservation);\r\n            const theme = await new DaoTheme().getThemeBySalle(salle);\r\n            const resaDetail = [reservation, salle, theme, obstacle];\r\n            this.setState({\r\n                reservationDetailee: resaDetail,\r\n            });\r\n            document.body.style.cursor = 'default';\r\n            return resaDetail;\r\n        } else{\r\n            return  this.state.reservationDetailee;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Affiche ou non le composant DetailsTransaction\r\n     * @link {DetailsTransaction}\r\n     * @returns {null|*}\r\n     */\r\n    afficherDetails(){\r\n        if (this.state.details > -1) {\r\n            let reservationDetaille = this.loadReservation();\r\n            return <DetailsTransaction reservationDetailee={reservationDetaille}/>\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    updateTransaction(){\r\n        //console.log(\"ici\");\r\n        this.setState({\r\n            client: this.props.client,\r\n            details : -1,\r\n            lastDetails: -1\r\n        });\r\n    }\r\n\r\n    render() {\r\n        const transactions = this.props.transactions;\r\n        if (this.state.client.id !== this.props.client.id) {\r\n            this.updateTransaction();\r\n            return null\r\n        } else {\r\n            //console.log(this.state);\r\n            const options = {weekday: \"short\", day: \"numeric\", month: \"short\", year: \"numeric\"};\r\n            if (transactions.length > 0) {\r\n                return (\r\n                    <section className=\"transactions\">\r\n                        <h2 className=\"title\">TRANSACTIONS</h2>\r\n                        <section className=\"tableau\">\r\n                            <h3 className=\"colonne\">Date</h3>\r\n                            <h3 className=\"colonne bordure\">Montant</h3>\r\n                            {transactions.map((t, i) => {\r\n                                const date = new Intl.DateTimeFormat(\"fr-FR\", options).format(t.date);\r\n                                if (transactions[i].reservation !== \" \") {\r\n                                    const selected = (this.state.details === i);\r\n                                    return (\r\n                                        <section className={\"ligne depense \" + selected} key={i}\r\n                                                 onClick={this.details.bind(this, i)}>\r\n                                            <span className=\"date\">{date.toUpperCase()}</span>\r\n                                            <span className=\"montant bordure\">{t.montant}</span>\r\n                                        </section>\r\n                                    )\r\n                                } else {\r\n                                    return (\r\n                                        <section className={\"ligne ajout\"} key={i}>\r\n                                            <span className=\"date\">{date.toUpperCase()}</span>\r\n                                            <span className=\"montant bordure\">{t.montant}</span>\r\n                                        </section>\r\n                                    )\r\n                                }\r\n                            })}\r\n                        </section>\r\n                        {this.afficherDetails()}\r\n                    </section>\r\n                );\r\n            } else {\r\n                return null;\r\n            }\r\n        }\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}