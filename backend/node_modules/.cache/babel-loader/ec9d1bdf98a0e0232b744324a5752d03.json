{"ast":null,"code":"import Dbal from \"./Dbal\";\nimport client from \"../metier/Client\";\nimport DaoTransaction from \"./DaoTransaction\";\nimport DaoUtilisateur from \"./DaoUtilisateur\";\nexport default class DaoClient {\n  /**\r\n   * Singleon\r\n   * @returns {DaoClient|DaoClient}\r\n   */\n  constructor() {\n    if (!!DaoClient.instance) {\n      return DaoClient.instance;\n    }\n    /**@type {DaoClient}**/\n\n\n    DaoClient.instance = this;\n    /**@type {Dbal}**/\n\n    this.dbal = new Dbal();\n    return this;\n  }\n  /**\r\n   * Récupère tous les clients\r\n   * @returns {Promise<[]>}\r\n   */\n\n\n  async getAll() {\n    const liste = [];\n    const reponse = await this.dbal.get(\"/api/clients\");\n    const clients = JSON.parse(reponse);\n\n    for (const c of clients) {\n      liste.push(new client(c));\n    }\n\n    return liste;\n  }\n  /**\r\n   * Récupère un client à partir de sn Id\r\n   * @param id {number}\r\n   * @returns {Promise<client>}\r\n   */\n\n\n  async getById(id) {\n    const url = \"/api/clients/\" + id;\n    const reponse = await this.dbal.get(url);\n    return new client(JSON.parse(reponse));\n  }\n  /**\r\n   * Récupère les données spécifiques d'un client\r\n   * @param c {Client}\r\n   * @returns {Promise<client>}\r\n   */\n\n\n  async load(c) {\n    let reponse = await this.dbal.get(c.ville);\n    c.ville = JSON.parse(reponse).nom;\n    reponse = await this.dbal.get(\"/api/client/soldeById/\" + c.id);\n    c.solde = JSON.parse(reponse);\n    return new client(c);\n  }\n  /**\r\n   * Archive un client\r\n   * @param client {Client}\r\n   * @param valeur {string}\r\n   * @returns {Promise<string>}\r\n   */\n\n\n  async archiver(client, valeur) {\n    const url = \"/api/clients/modifClient/\" + client.id;\n    const params = '{\"id\":\"' + client.id + '\",\"nom\":\"\",\"prenom\":\"\",\"ville\":\"\",\"tel\":\"\",\"mail\": \"\",\"archive\":\"' + valeur + '\"}';\n    return await this.dbal.put(url, params);\n  }\n  /**\r\n   * Modifie un client\r\n   * @param client {Client}\r\n   * @returns {Promise<string>}\r\n   */\n\n\n  async modifier(client) {\n    const archive = !client.archive ? \"0\" : \"1\";\n    const url = \"/api/clients/modifclient\";\n    const params = '{\"id\":\"' + client.id + '\",\"nom\":\"' + client.nom + '\",\"prenom\":\"' + client.prenom + '\",\"ville\":\"' + client.ville + '\",\"tel\":\"' + client.tel + '\",\"mail\":\"' + client.mail + '\",\"archive\":\"' + archive + '\"}';\n    return await this.dbal.put(url, params);\n  }\n  /**\r\n   * Crée un client\r\n   * @param client {Client}\r\n   * @returns {Promise<client>}\r\n   */\n\n\n  async creer(client) {\n    let url = \"/api/clients/addClient\";\n    const params = '{\"id\":\"' + client.id + '\",\"nom\":\"' + client.nom + '\",\"prenom\":\"' + client.prenom + '\",\"ville\":\"' + client.ville + '\",\"tel\":\"' + client.tel + '\",\"mail\":\"' + client.mail + '\",\"archive\":\"0\"}';\n    let reponse = await this.dbal.post(url, params);\n    const lastId = JSON.parse(reponse);\n    client = await this.getById(lastId);\n    new DaoTransaction().initialiser(client);\n    new DaoUtilisateur().addUser(client);\n    return await this.load(client);\n  }\n\n}","map":{"version":3,"sources":["C:/wamp64/www/PPE2/DeuxiemeSituation/backend/src/modele/DaoClient.js"],"names":["Dbal","client","DaoTransaction","DaoUtilisateur","DaoClient","constructor","instance","dbal","getAll","liste","reponse","get","clients","JSON","parse","c","push","getById","id","url","load","ville","nom","solde","archiver","valeur","params","put","modifier","archive","prenom","tel","mail","creer","post","lastId","initialiser","addUser"],"mappings":"AAAA,OAAOA,IAAP,MAAiB,QAAjB;AACA,OAAOC,MAAP,MAAmB,kBAAnB;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AAEA,eAAe,MAAMC,SAAN,CAAgB;AAC3B;;;;AAIAC,EAAAA,WAAW,GAAG;AACV,QAAI,CAAC,CAACD,SAAS,CAACE,QAAhB,EAA0B;AACtB,aAAOF,SAAS,CAACE,QAAjB;AACH;AACD;;;AACAF,IAAAA,SAAS,CAACE,QAAV,GAAqB,IAArB;AACA;;AACA,SAAKC,IAAL,GAAY,IAAIP,IAAJ,EAAZ;AACA,WAAO,IAAP;AACH;AAED;;;;;;AAIA,QAAMQ,MAAN,GAAc;AACV,UAAMC,KAAK,GAAI,EAAf;AACA,UAAMC,OAAO,GAAG,MAAM,KAAKH,IAAL,CAAUI,GAAV,CAAc,cAAd,CAAtB;AACA,UAAMC,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAWJ,OAAX,CAAhB;;AACA,SAAK,MAAMK,CAAX,IAAgBH,OAAhB,EAAyB;AACrBH,MAAAA,KAAK,CAACO,IAAN,CAAW,IAAIf,MAAJ,CAAWc,CAAX,CAAX;AACH;;AACD,WAAON,KAAP;AACH;AAED;;;;;;;AAKA,QAAMQ,OAAN,CAAcC,EAAd,EAAiB;AACb,UAAMC,GAAG,GAAG,kBAAkBD,EAA9B;AACA,UAAMR,OAAO,GAAG,MAAM,KAAKH,IAAL,CAAUI,GAAV,CAAcQ,GAAd,CAAtB;AACA,WAAO,IAAIlB,MAAJ,CAAWY,IAAI,CAACC,KAAL,CAAWJ,OAAX,CAAX,CAAP;AACH;AAED;;;;;;;AAKA,QAAMU,IAAN,CAAWL,CAAX,EAAa;AACT,QAAIL,OAAO,GAAG,MAAM,KAAKH,IAAL,CAAUI,GAAV,CAAcI,CAAC,CAACM,KAAhB,CAApB;AACAN,IAAAA,CAAC,CAACM,KAAF,GAAWR,IAAI,CAACC,KAAL,CAAWJ,OAAX,CAAD,CAAsBY,GAAhC;AACAZ,IAAAA,OAAO,GAAG,MAAM,KAAKH,IAAL,CAAUI,GAAV,CAAc,2BAA2BI,CAAC,CAACG,EAA3C,CAAhB;AACAH,IAAAA,CAAC,CAACQ,KAAF,GAAUV,IAAI,CAACC,KAAL,CAAWJ,OAAX,CAAV;AACA,WAAO,IAAIT,MAAJ,CAAWc,CAAX,CAAP;AACH;AAED;;;;;;;;AAMA,QAAMS,QAAN,CAAevB,MAAf,EAAuBwB,MAAvB,EAA8B;AAC1B,UAAMN,GAAG,GAAG,8BAA6BlB,MAAM,CAACiB,EAAhD;AACA,UAAMQ,MAAM,GAAG,YAAUzB,MAAM,CAACiB,EAAjB,GAAoB,mEAApB,GAAwFO,MAAxF,GAA+F,IAA9G;AACA,WAAO,MAAM,KAAKlB,IAAL,CAAUoB,GAAV,CAAcR,GAAd,EAAmBO,MAAnB,CAAb;AACH;AAED;;;;;;;AAKA,QAAME,QAAN,CAAe3B,MAAf,EAAsB;AAClB,UAAM4B,OAAO,GAAI,CAAC5B,MAAM,CAAC4B,OAAT,GAAkB,GAAlB,GAAsB,GAAtC;AACA,UAAMV,GAAG,GAAG,0BAAZ;AACA,UAAMO,MAAM,GAAG,YAAUzB,MAAM,CAACiB,EAAjB,GAAoB,WAApB,GAAgCjB,MAAM,CAACqB,GAAvC,GAA2C,cAA3C,GAA0DrB,MAAM,CAAC6B,MAAjE,GAAwE,aAAxE,GAAsF7B,MAAM,CAACoB,KAA7F,GAAmG,WAAnG,GAA+GpB,MAAM,CAAC8B,GAAtH,GAA0H,YAA1H,GAAuI9B,MAAM,CAAC+B,IAA9I,GAAmJ,eAAnJ,GAAmKH,OAAnK,GAA2K,IAA1L;AACA,WAAO,MAAM,KAAKtB,IAAL,CAAUoB,GAAV,CAAcR,GAAd,EAAmBO,MAAnB,CAAb;AACH;AAED;;;;;;;AAKA,QAAMO,KAAN,CAAYhC,MAAZ,EAAmB;AACf,QAAIkB,GAAG,GAAG,wBAAV;AACA,UAAMO,MAAM,GAAG,YAAUzB,MAAM,CAACiB,EAAjB,GAAoB,WAApB,GAAgCjB,MAAM,CAACqB,GAAvC,GAA2C,cAA3C,GAA0DrB,MAAM,CAAC6B,MAAjE,GAAwE,aAAxE,GAAsF7B,MAAM,CAACoB,KAA7F,GAAmG,WAAnG,GAA+GpB,MAAM,CAAC8B,GAAtH,GAA0H,YAA1H,GAAuI9B,MAAM,CAAC+B,IAA9I,GAAmJ,kBAAlK;AACA,QAAItB,OAAO,GAAG,MAAM,KAAKH,IAAL,CAAU2B,IAAV,CAAef,GAAf,EAAoBO,MAApB,CAApB;AACA,UAAMS,MAAM,GAAGtB,IAAI,CAACC,KAAL,CAAWJ,OAAX,CAAf;AACAT,IAAAA,MAAM,GAAG,MAAM,KAAKgB,OAAL,CAAakB,MAAb,CAAf;AAEA,QAAIjC,cAAJ,GAAqBkC,WAArB,CAAiCnC,MAAjC;AACA,QAAIE,cAAJ,GAAqBkC,OAArB,CAA6BpC,MAA7B;AACA,WAAO,MAAM,KAAKmB,IAAL,CAAUnB,MAAV,CAAb;AACH;;AA7F0B","sourcesContent":["import Dbal from \"./Dbal\";\r\nimport client from \"../metier/Client\";\r\nimport DaoTransaction from \"./DaoTransaction\";\r\nimport DaoUtilisateur from \"./DaoUtilisateur\";\r\n\r\nexport default class DaoClient {\r\n    /**\r\n     * Singleon\r\n     * @returns {DaoClient|DaoClient}\r\n     */\r\n    constructor() {\r\n        if (!!DaoClient.instance) {\r\n            return DaoClient.instance;\r\n        }\r\n        /**@type {DaoClient}**/\r\n        DaoClient.instance = this;\r\n        /**@type {Dbal}**/\r\n        this.dbal = new Dbal();\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Récupère tous les clients\r\n     * @returns {Promise<[]>}\r\n     */\r\n    async getAll(){\r\n        const liste =  [];\r\n        const reponse = await this.dbal.get(\"/api/clients\");\r\n        const clients = JSON.parse(reponse);\r\n        for (const c of clients) {\r\n            liste.push(new client(c));\r\n        }\r\n        return liste;\r\n    }\r\n\r\n    /**\r\n     * Récupère un client à partir de sn Id\r\n     * @param id {number}\r\n     * @returns {Promise<client>}\r\n     */\r\n    async getById(id){\r\n        const url = \"/api/clients/\" + id;\r\n        const reponse = await this.dbal.get(url);\r\n        return new client(JSON.parse(reponse));\r\n    }\r\n\r\n    /**\r\n     * Récupère les données spécifiques d'un client\r\n     * @param c {Client}\r\n     * @returns {Promise<client>}\r\n     */\r\n    async load(c){\r\n        let reponse = await this.dbal.get(c.ville);\r\n        c.ville = (JSON.parse(reponse)).nom;\r\n        reponse = await this.dbal.get(\"/api/client/soldeById/\" + c.id);\r\n        c.solde = JSON.parse(reponse);\r\n        return new client(c);\r\n    }\r\n\r\n    /**\r\n     * Archive un client\r\n     * @param client {Client}\r\n     * @param valeur {string}\r\n     * @returns {Promise<string>}\r\n     */\r\n    async archiver(client, valeur){\r\n        const url = \"/api/clients/modifClient/\"+ client.id;\r\n        const params = '{\"id\":\"'+client.id+'\",\"nom\":\"\",\"prenom\":\"\",\"ville\":\"\",\"tel\":\"\",\"mail\": \"\",\"archive\":\"'+valeur+'\"}';\r\n        return await this.dbal.put(url, params);\r\n    }\r\n\r\n    /**\r\n     * Modifie un client\r\n     * @param client {Client}\r\n     * @returns {Promise<string>}\r\n     */\r\n    async modifier(client){\r\n        const archive = (!client.archive)?\"0\":\"1\";\r\n        const url = \"/api/clients/modifclient\";\r\n        const params = '{\"id\":\"'+client.id+'\",\"nom\":\"'+client.nom+'\",\"prenom\":\"'+client.prenom+'\",\"ville\":\"'+client.ville+'\",\"tel\":\"'+client.tel+'\",\"mail\":\"'+client.mail+'\",\"archive\":\"'+archive+'\"}';\r\n        return await this.dbal.put(url, params);\r\n    }\r\n\r\n    /**\r\n     * Crée un client\r\n     * @param client {Client}\r\n     * @returns {Promise<client>}\r\n     */\r\n    async creer(client){\r\n        let url = \"/api/clients/addClient\";\r\n        const params = '{\"id\":\"'+client.id+'\",\"nom\":\"'+client.nom+'\",\"prenom\":\"'+client.prenom+'\",\"ville\":\"'+client.ville+'\",\"tel\":\"'+client.tel+'\",\"mail\":\"'+client.mail+'\",\"archive\":\"0\"}';\r\n        let reponse = await this.dbal.post(url, params);\r\n        const lastId = JSON.parse(reponse);\r\n        client = await this.getById(lastId);\r\n\r\n        new DaoTransaction().initialiser(client);\r\n        new DaoUtilisateur().addUser(client);\r\n        return await this.load(client);\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}