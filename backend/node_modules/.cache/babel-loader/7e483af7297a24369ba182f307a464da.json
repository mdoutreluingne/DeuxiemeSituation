{"ast":null,"code":"var _jsxFileName = \"C:\\\\wamp64\\\\www\\\\PPE2\\\\DeuxiemeSituation\\\\backend\\\\src\\\\components\\\\Transactions.js\";\nimport React from 'react';\nimport DetailsTransaction from \"./DetailsTransaction\";\nimport DaoSalle from \"../modele/DaoSalle\";\nimport DaoReservation from \"../modele/DaoReservation\";\nimport DaoObstacle from \"../modele/DaoObstacle\";\nimport DaoTheme from \"../modele/DaoTheme\";\n/**\r\n * Composant qui affiche la liste des transaction\r\n */\n\nexport default class Transactions extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      /**@type {Transaction}**/\n      transactions: null,\n\n      /**@type {number}**/\n      details: -1,\n\n      /**@type {number}**/\n      lastDetails: -1,\n\n      /**@type {[Reservation, Salle, Theme, [Obstacle]]}**/\n      reservationDetailee: null\n    };\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    this.setState({\n      transactions: this.props.transactions\n    });\n  }\n  /**\r\n   * Définit la transaction qui a été séléctionné\r\n   * @param index {number}\r\n   */\n\n\n  details(index) {\n    const transactions = this.props.transactions;\n\n    if (transactions[index].reservation !== \" \") {\n      if (this.state.details === index) {\n        this.setState({\n          lastDetails: this.state.details,\n          details: -1\n        });\n      } else {\n        this.setState({\n          details: index\n        });\n      }\n    }\n  }\n  /**\r\n   * Charge le détail d'une réservation\r\n   * @returns {Promise<(Reservation|Salle|Theme|Obstacle[])[]|null|[Reservation, Salle, Theme, *[]]>}\r\n   */\n\n\n  async loadReservation() {\n    if (this.state.lastDetails !== this.state.details) {\n      document.body.style.cursor = 'progress';\n      const transaction = this.props.transactions[this.state.details];\n      const reservation = await new DaoReservation().getReservationByTransaction(transaction);\n      const salle = await new DaoSalle().getSalleByReservation(reservation);\n      const obstacle = await new DaoObstacle().getObstacleByReservation(reservation);\n      const theme = await new DaoTheme().getThemeBySalle(salle);\n      const resaDetail = [reservation, salle, theme, obstacle];\n      this.setState({\n        reservationDetailee: resaDetail\n      });\n      document.body.style.cursor = 'default';\n      return resaDetail;\n    } else {\n      return this.state.reservationDetailee;\n    }\n  }\n  /**\r\n   * Affiche ou non le composant DetailsTransaction\r\n   * @link {DetailsTransaction}\r\n   * @returns {null|*}\r\n   */\n\n\n  afficherDetails() {\n    if (this.state.details > -1) {\n      let reservationDetaille = this.loadReservation();\n      return React.createElement(DetailsTransaction, {\n        reservationDetailee: reservationDetaille,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83\n        },\n        __self: this\n      });\n    } else {\n      return null;\n    }\n  }\n\n  updateTransaction() {\n    console.log(\"ici\");\n    this.setState({\n      details: -1,\n      lastDetails: -1\n    });\n  }\n\n  render() {\n    const transactions = this.props.transactions; // && transactions[0].id !== this.state.transaction[0].id\n    //console.log(this.state.transactions);\n\n    if (this.state.transaction !== undefined) {\n      //this.updateTransaction();\n      return null;\n    } else {\n      //console.log(this.state);\n      const options = {\n        weekday: \"short\",\n        day: \"numeric\",\n        month: \"short\",\n        year: \"numeric\"\n      };\n\n      if (transactions.length > 0) {\n        return React.createElement(\"section\", {\n          className: \"transactions\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 109\n          },\n          __self: this\n        }, React.createElement(\"h2\", {\n          className: \"title\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 110\n          },\n          __self: this\n        }, \"TRANSACTIONS\"), React.createElement(\"section\", {\n          className: \"tableau\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 111\n          },\n          __self: this\n        }, React.createElement(\"h3\", {\n          className: \"colonne\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 112\n          },\n          __self: this\n        }, \"Date\"), React.createElement(\"h3\", {\n          className: \"colonne bordure\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 113\n          },\n          __self: this\n        }, \"Montant\"), transactions.map((t, i) => {\n          const date = new Intl.DateTimeFormat(\"fr-FR\", options).format(t.date);\n\n          if (transactions[i].reservation !== \" \") {\n            const selected = this.state.details === i;\n            return React.createElement(\"section\", {\n              className: \"ligne depense \" + selected,\n              key: i,\n              onClick: this.details.bind(this, i),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 119\n              },\n              __self: this\n            }, React.createElement(\"span\", {\n              className: \"date\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 121\n              },\n              __self: this\n            }, date.toUpperCase()), React.createElement(\"span\", {\n              className: \"montant bordure\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 122\n              },\n              __self: this\n            }, t.montant));\n          } else {\n            return React.createElement(\"section\", {\n              className: \"ligne ajout\",\n              key: i,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 127\n              },\n              __self: this\n            }, React.createElement(\"span\", {\n              className: \"date\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 128\n              },\n              __self: this\n            }, date.toUpperCase()), React.createElement(\"span\", {\n              className: \"montant bordure\",\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 129\n              },\n              __self: this\n            }, t.montant));\n          }\n        })), this.afficherDetails());\n      } else {\n        return null;\n      }\n    }\n  }\n\n}","map":{"version":3,"sources":["C:/wamp64/www/PPE2/DeuxiemeSituation/backend/src/components/Transactions.js"],"names":["React","DetailsTransaction","DaoSalle","DaoReservation","DaoObstacle","DaoTheme","Transactions","Component","constructor","props","state","transactions","details","lastDetails","reservationDetailee","componentDidUpdate","prevProps","prevState","snapshot","setState","index","reservation","loadReservation","document","body","style","cursor","transaction","getReservationByTransaction","salle","getSalleByReservation","obstacle","getObstacleByReservation","theme","getThemeBySalle","resaDetail","afficherDetails","reservationDetaille","updateTransaction","console","log","render","undefined","options","weekday","day","month","year","length","map","t","i","date","Intl","DateTimeFormat","format","selected","bind","toUpperCase","montant"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,kBAAP,MAA+B,sBAA/B;AACA,OAAOC,QAAP,MAAqB,oBAArB;AACA,OAAOC,cAAP,MAA2B,0BAA3B;AACA,OAAOC,WAAP,MAAwB,uBAAxB;AACA,OAAOC,QAAP,MAAqB,oBAArB;AAEA;;;;AAGA,eAAe,MAAMC,YAAN,SAA2BN,KAAK,CAACO,SAAjC,CAA2C;AACtDC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACf,UAAMA,KAAN;AACA,SAAKC,KAAL,GAAa;AACT;AACAC,MAAAA,YAAY,EAAE,IAFL;;AAGT;AACAC,MAAAA,OAAO,EAAE,CAAC,CAJD;;AAKT;AACAC,MAAAA,WAAW,EAAE,CAAC,CANL;;AAOT;AACAC,MAAAA,mBAAmB,EAAE;AARZ,KAAb;AAUH;;AAEDC,EAAAA,kBAAkB,CAACC,SAAD,EAAYC,SAAZ,EAAuBC,QAAvB,EAAiC;AAC/C,SAAKC,QAAL,CAAc;AACVR,MAAAA,YAAY,EAAE,KAAKF,KAAL,CAAWE;AADf,KAAd;AAGH;AAED;;;;;;AAIAC,EAAAA,OAAO,CAACQ,KAAD,EAAO;AACV,UAAMT,YAAY,GAAG,KAAKF,KAAL,CAAWE,YAAhC;;AACA,QAAIA,YAAY,CAACS,KAAD,CAAZ,CAAoBC,WAApB,KAAoC,GAAxC,EAA4C;AACxC,UAAI,KAAKX,KAAL,CAAWE,OAAX,KAAuBQ,KAA3B,EAAiC;AAC7B,aAAKD,QAAL,CAAc;AACVN,UAAAA,WAAW,EAAE,KAAKH,KAAL,CAAWE,OADd;AAEVA,UAAAA,OAAO,EAAE,CAAC;AAFA,SAAd;AAIH,OALD,MAKO;AACH,aAAKO,QAAL,CAAc;AACVP,UAAAA,OAAO,EAAEQ;AADC,SAAd;AAGH;AACJ;AACJ;AAED;;;;;;AAIA,QAAME,eAAN,GAAuB;AACnB,QAAI,KAAKZ,KAAL,CAAWG,WAAX,KAA2B,KAAKH,KAAL,CAAWE,OAA1C,EAAmD;AAC/CW,MAAAA,QAAQ,CAACC,IAAT,CAAcC,KAAd,CAAoBC,MAApB,GAA6B,UAA7B;AACA,YAAMC,WAAW,GAAG,KAAKlB,KAAL,CAAWE,YAAX,CAAwB,KAAKD,KAAL,CAAWE,OAAnC,CAApB;AACA,YAAMS,WAAW,GAAG,MAAM,IAAIlB,cAAJ,GAAqByB,2BAArB,CAAiDD,WAAjD,CAA1B;AACA,YAAME,KAAK,GAAG,MAAM,IAAI3B,QAAJ,GAAe4B,qBAAf,CAAqCT,WAArC,CAApB;AACA,YAAMU,QAAQ,GAAG,MAAM,IAAI3B,WAAJ,GAAkB4B,wBAAlB,CAA2CX,WAA3C,CAAvB;AACA,YAAMY,KAAK,GAAG,MAAM,IAAI5B,QAAJ,GAAe6B,eAAf,CAA+BL,KAA/B,CAApB;AACA,YAAMM,UAAU,GAAG,CAACd,WAAD,EAAcQ,KAAd,EAAqBI,KAArB,EAA4BF,QAA5B,CAAnB;AACA,WAAKZ,QAAL,CAAc;AACVL,QAAAA,mBAAmB,EAAEqB;AADX,OAAd;AAGAZ,MAAAA,QAAQ,CAACC,IAAT,CAAcC,KAAd,CAAoBC,MAApB,GAA6B,SAA7B;AACA,aAAOS,UAAP;AACH,KAbD,MAaM;AACF,aAAQ,KAAKzB,KAAL,CAAWI,mBAAnB;AACH;AACJ;AAED;;;;;;;AAKAsB,EAAAA,eAAe,GAAE;AACb,QAAI,KAAK1B,KAAL,CAAWE,OAAX,GAAqB,CAAC,CAA1B,EAA6B;AACzB,UAAIyB,mBAAmB,GAAG,KAAKf,eAAL,EAA1B;AACA,aAAO,oBAAC,kBAAD;AAAoB,QAAA,mBAAmB,EAAEe,mBAAzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAP;AACH,KAHD,MAGO;AACH,aAAO,IAAP;AACH;AACJ;;AAEDC,EAAAA,iBAAiB,GAAE;AACfC,IAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ;AACA,SAAKrB,QAAL,CAAc;AACVP,MAAAA,OAAO,EAAG,CAAC,CADD;AAEVC,MAAAA,WAAW,EAAE,CAAC;AAFJ,KAAd;AAIH;;AAED4B,EAAAA,MAAM,GAAG;AACL,UAAM9B,YAAY,GAAG,KAAKF,KAAL,CAAWE,YAAhC,CADK,CAEL;AACA;;AACA,QAAI,KAAKD,KAAL,CAAWiB,WAAX,KAA2Be,SAA/B,EAAyC;AACrC;AACA,aAAO,IAAP;AACH,KAHD,MAGO;AACH;AACA,YAAMC,OAAO,GAAG;AAACC,QAAAA,OAAO,EAAE,OAAV;AAAmBC,QAAAA,GAAG,EAAE,SAAxB;AAAmCC,QAAAA,KAAK,EAAE,OAA1C;AAAmDC,QAAAA,IAAI,EAAE;AAAzD,OAAhB;;AACA,UAAIpC,YAAY,CAACqC,MAAb,GAAsB,CAA1B,EAA6B;AACzB,eACI;AAAS,UAAA,SAAS,EAAC,cAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACI;AAAI,UAAA,SAAS,EAAC,OAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BADJ,EAEI;AAAS,UAAA,SAAS,EAAC,SAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACI;AAAI,UAAA,SAAS,EAAC,SAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADJ,EAEI;AAAI,UAAA,SAAS,EAAC,iBAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAFJ,EAGKrC,YAAY,CAACsC,GAAb,CAAiB,CAACC,CAAD,EAAIC,CAAJ,KAAU;AACxB,gBAAMC,IAAI,GAAG,IAAIC,IAAI,CAACC,cAAT,CAAwB,OAAxB,EAAiCX,OAAjC,EAA0CY,MAA1C,CAAiDL,CAAC,CAACE,IAAnD,CAAb;;AACA,cAAIzC,YAAY,CAACwC,CAAD,CAAZ,CAAgB9B,WAAhB,KAAgC,GAApC,EAAyC;AACrC,kBAAMmC,QAAQ,GAAI,KAAK9C,KAAL,CAAWE,OAAX,KAAuBuC,CAAzC;AACA,mBACI;AAAS,cAAA,SAAS,EAAE,mBAAmBK,QAAvC;AAAiD,cAAA,GAAG,EAAEL,CAAtD;AACS,cAAA,OAAO,EAAE,KAAKvC,OAAL,CAAa6C,IAAb,CAAkB,IAAlB,EAAwBN,CAAxB,CADlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAEI;AAAM,cAAA,SAAS,EAAC,MAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAAwBC,IAAI,CAACM,WAAL,EAAxB,CAFJ,EAGI;AAAM,cAAA,SAAS,EAAC,iBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAAmCR,CAAC,CAACS,OAArC,CAHJ,CADJ;AAOH,WATD,MASO;AACH,mBACI;AAAS,cAAA,SAAS,EAAE,aAApB;AAAmC,cAAA,GAAG,EAAER,CAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eACI;AAAM,cAAA,SAAS,EAAC,MAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAAwBC,IAAI,CAACM,WAAL,EAAxB,CADJ,EAEI;AAAM,cAAA,SAAS,EAAC,iBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAAmCR,CAAC,CAACS,OAArC,CAFJ,CADJ;AAMH;AACJ,SAnBA,CAHL,CAFJ,EA0BK,KAAKvB,eAAL,EA1BL,CADJ;AA8BH,OA/BD,MA+BO;AACH,eAAO,IAAP;AACH;AACJ;AACJ;;AAnIqD","sourcesContent":["import React from 'react';\r\nimport DetailsTransaction from \"./DetailsTransaction\";\r\nimport DaoSalle from \"../modele/DaoSalle\";\r\nimport DaoReservation from \"../modele/DaoReservation\";\r\nimport DaoObstacle from \"../modele/DaoObstacle\";\r\nimport DaoTheme from \"../modele/DaoTheme\";\r\n\r\n/**\r\n * Composant qui affiche la liste des transaction\r\n */\r\nexport default class Transactions extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            /**@type {Transaction}**/\r\n            transactions: null,\r\n            /**@type {number}**/\r\n            details: -1,\r\n            /**@type {number}**/\r\n            lastDetails: -1,\r\n            /**@type {[Reservation, Salle, Theme, [Obstacle]]}**/\r\n            reservationDetailee: null\r\n        }\r\n    }\r\n\r\n    componentDidUpdate(prevProps, prevState, snapshot) {\r\n        this.setState({\r\n            transactions: this.props.transactions\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Définit la transaction qui a été séléctionné\r\n     * @param index {number}\r\n     */\r\n    details(index){\r\n        const transactions = this.props.transactions;\r\n        if (transactions[index].reservation !== \" \"){\r\n            if (this.state.details === index){\r\n                this.setState({\r\n                    lastDetails: this.state.details,\r\n                    details: -1\r\n                })\r\n            } else {\r\n                this.setState({\r\n                    details: index,\r\n                })\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Charge le détail d'une réservation\r\n     * @returns {Promise<(Reservation|Salle|Theme|Obstacle[])[]|null|[Reservation, Salle, Theme, *[]]>}\r\n     */\r\n    async loadReservation(){\r\n        if (this.state.lastDetails !== this.state.details) {\r\n            document.body.style.cursor = 'progress';\r\n            const transaction = this.props.transactions[this.state.details];\r\n            const reservation = await new DaoReservation().getReservationByTransaction(transaction);\r\n            const salle = await new DaoSalle().getSalleByReservation(reservation);\r\n            const obstacle = await new DaoObstacle().getObstacleByReservation(reservation);\r\n            const theme = await new DaoTheme().getThemeBySalle(salle);\r\n            const resaDetail = [reservation, salle, theme, obstacle];\r\n            this.setState({\r\n                reservationDetailee: resaDetail,\r\n            });\r\n            document.body.style.cursor = 'default';\r\n            return resaDetail;\r\n        } else{\r\n            return  this.state.reservationDetailee;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Affiche ou non le composant DetailsTransaction\r\n     * @link {DetailsTransaction}\r\n     * @returns {null|*}\r\n     */\r\n    afficherDetails(){\r\n        if (this.state.details > -1) {\r\n            let reservationDetaille = this.loadReservation();\r\n            return <DetailsTransaction reservationDetailee={reservationDetaille}/>\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    updateTransaction(){\r\n        console.log(\"ici\");\r\n        this.setState({\r\n            details : -1,\r\n            lastDetails: -1\r\n        });\r\n    }\r\n\r\n    render() {\r\n        const transactions = this.props.transactions;\r\n        // && transactions[0].id !== this.state.transaction[0].id\r\n        //console.log(this.state.transactions);\r\n        if (this.state.transaction !== undefined){\r\n            //this.updateTransaction();\r\n            return null\r\n        } else {\r\n            //console.log(this.state);\r\n            const options = {weekday: \"short\", day: \"numeric\", month: \"short\", year: \"numeric\"};\r\n            if (transactions.length > 0) {\r\n                return (\r\n                    <section className=\"transactions\">\r\n                        <h2 className=\"title\">TRANSACTIONS</h2>\r\n                        <section className=\"tableau\">\r\n                            <h3 className=\"colonne\">Date</h3>\r\n                            <h3 className=\"colonne bordure\">Montant</h3>\r\n                            {transactions.map((t, i) => {\r\n                                const date = new Intl.DateTimeFormat(\"fr-FR\", options).format(t.date);\r\n                                if (transactions[i].reservation !== \" \") {\r\n                                    const selected = (this.state.details === i);\r\n                                    return (\r\n                                        <section className={\"ligne depense \" + selected} key={i}\r\n                                                 onClick={this.details.bind(this, i)}>\r\n                                            <span className=\"date\">{date.toUpperCase()}</span>\r\n                                            <span className=\"montant bordure\">{t.montant}</span>\r\n                                        </section>\r\n                                    )\r\n                                } else {\r\n                                    return (\r\n                                        <section className={\"ligne ajout\"} key={i}>\r\n                                            <span className=\"date\">{date.toUpperCase()}</span>\r\n                                            <span className=\"montant bordure\">{t.montant}</span>\r\n                                        </section>\r\n                                    )\r\n                                }\r\n                            })}\r\n                        </section>\r\n                        {this.afficherDetails()}\r\n                    </section>\r\n                );\r\n            } else {\r\n                return null;\r\n            }\r\n        }\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}